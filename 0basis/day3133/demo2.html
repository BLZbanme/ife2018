<!DOCTYPE html>
<html>
    <head>
        <style>
            div {
                width : 80%;
                margin: 0 auto;
            }

            table{
                margin: 0 auto;
            }

            td {
                text-align: center;
            }
            
        </style>
    </head>
    <body>
        <div id='total'>
            <div id="region-radio-wrapper"></div>
            <div id="product-radio-wrapper"></div>
            <div id='table-wrapper'></div>
        </div>
        <script>
            let sourceData = [{
                product: "手机",
                region: "华东",
                sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
            }, {
                product: "手机",
                region: "华北",
                sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
            }, {
                product: "手机",
                region: "华南",
                sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
            }, {
                product: "笔记本",
                region: "华东",
                sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
            }, {
                product: "笔记本",
                region: "华北",
                sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
            }, {
                product: "笔记本",
                region: "华南",
                sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
            }, {
                product: "智能音箱",
                region: "华东",
                sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
            }, {
                product: "智能音箱",
                region: "华北",
                sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
            }, {
                product: "智能音箱",
                region: "华南",
                sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
            }]
            let months = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            let regionArray = ['华东', '华北', '华南' ];
            let productArray = ['手机', '笔记本', '智能音箱' ];
            let regions = [
                {
                    value: 0,
                    text: '华东'
                },
                {
                    value: 1,
                    text: '华北' 
                },
                {
                    value: 2,
                    text: '华南' 
                }
                ];

            let products = [
            {
                value: 0,
                text: '手机'
            },
            {
                value: 1,
                text: '笔记本' 
            },
            {
                value: 2,
                text: '智能音箱'
            }
            ];

            function makeCheckBox(obj){
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = obj.value;
                checkbox.defaultChecked = true;
                return checkbox;
            }

            function makeLabel(obj){
                var label = document.createElement('label');
                label.innerHTML = obj.text;
                return label;
            }
            function creatCheckBox(str, arr){
                var div = document.querySelector('#' + str);
                for(let i in arr){
                    var checkbox = makeCheckBox(arr[i])
                    div.appendChild(checkbox);
                    var label = makeLabel(arr[i])
                    div.appendChild(label);
                }
            }
            creatCheckBox('region-radio-wrapper', regions);
            creatCheckBox('product-radio-wrapper', products);

            function createTableHeader(table){
                var thr = document.createElement('tr');
                var sp = document.createElement('th');
                sp.innerHTML = '商品';
                thr.appendChild(sp);
                var dq = document.createElement('th');
                dq.innerHTML = '地区';
                thr.appendChild(dq);
                for(let i = 0; i < 12; i++){
                    var month = document.createElement('th');
                    month.innerHTML = months[i];
                    thr.appendChild(month);
                }
                table.appendChild(thr);
            }

            function ArrayContain(arr, str){
                for(let i in arr){
                    if(arr[i] == str){
                        return true;
                    }
                }
                return false;
            }

            function filterSourceData(){
                var regionBox = document.querySelectorAll('#region-radio-wrapper input');
                var productBox = document.querySelectorAll('#product-radio-wrapper input');
                var regionArr = [];
                for(let i in regionBox){
                    if(regionBox[i].checked){
                        regionArr.push(regionArray[regionBox[i].value]);
                    }
                }
                var productArr = [];
                for(let i in productBox){
                    if(productBox[i].checked){
                        productArr.push(productArray[productBox[i].value]);
                    }
                }
                let result = [];
                for(let obj in sourceData){
                    if(ArrayContain(regionArr, sourceData[obj].region) && ArrayContain(productArr, sourceData[obj].product)){
                        result.push(sourceData[obj]);
                    }
                }
                return result
            }

            function createtableRow(table){
                var data = filterSourceData();
                for(let obj in data){
                    var tr = document.createElement('tr');
                    var sp = document.createElement('td');
                    sp.innerHTML = data[obj].product;
                    tr.appendChild(sp);
                    var dq = document.createElement('td');
                    dq.innerHTML = data[obj].region;
                    tr.appendChild(dq);
                    var saleArr = data[obj].sale;
                    for(let i = 0; i < saleArr.length; i++){
                        var td = document.createElement('td');
                        td.innerHTML = saleArr[i];
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }
            }

            function isTheLastOne(e){
                var checked = e.target;
                var str = checked.parentElement.id;
                var inputs = document.querySelectorAll('#' + str + ' input');
                var num = 0;
                for(let i in inputs){
                    if(inputs[i].checked == false){
                        num++;
                    }
                }
                if(num == 3){
                    e.target.checked = true;
                }
            }

            function changeTable(e){
                if(e != null){
                    isTheLastOne(e);
                }
                document.querySelector('#table-wrapper').innerHTML = '';
                var table = document.createElement('table'); 
                table.border = '1px solid black'; 
                table.rules = 'all';
                var div = document.querySelector('#table-wrapper');
                div.appendChild(table);
                createTableHeader(table);
                createtableRow(table);
            }
            var productDiv = document.querySelector("#product-radio-wrapper");
            var regionDiv = document.querySelector("#region-radio-wrapper");
            productDiv.addEventListener('click', changeTable);
            regionDiv.addEventListener('click', changeTable);
            changeTable();
        </script>
    </body>
</html>